!function(t,n){"object"==typeof exports&&"undefined"!=typeof module?n(exports):"function"==typeof define&&define.amd?define(["exports"],n):n((t="undefined"!=typeof globalThis?globalThis:t||self).assistant={})}(this,(function(t){"use strict";var n,e=function(){return e=Object.assign||function(t){for(var n,e=1,o=arguments.length;e<o;e++)for(var a in n=arguments[e])Object.prototype.hasOwnProperty.call(n,a)&&(t[a]=n[a]);return t},e.apply(this,arguments)};function o(t,n,e,o){return new(e||(e=Promise))((function(a,i){function r(t){try{u(o.next(t))}catch(t){i(t)}}function s(t){try{u(o.throw(t))}catch(t){i(t)}}function u(t){var n;t.done?a(t.value):(n=t.value,n instanceof e?n:new e((function(t){t(n)}))).then(r,s)}u((o=o.apply(t,n||[])).next())}))}function a(t,n){var e,o,a,i,r={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(s){return function(u){return function(s){if(e)throw new TypeError("Generator is already executing.");for(;i&&(i=0,s[0]&&(r=0)),r;)try{if(e=1,o&&(a=2&s[0]?o.return:s[0]?o.throw||((a=o.return)&&a.call(o),0):o.next)&&!(a=a.call(o,s[1])).done)return a;switch(o=0,a&&(s=[2&s[0],a.value]),s[0]){case 0:case 1:a=s;break;case 4:return r.label++,{value:s[1],done:!1};case 5:r.label++,o=s[1],s=[0];continue;case 7:s=r.ops.pop(),r.trys.pop();continue;default:if(!(a=r.trys,(a=a.length>0&&a[a.length-1])||6!==s[0]&&2!==s[0])){r=0;continue}if(3===s[0]&&(!a||s[1]>a[0]&&s[1]<a[3])){r.label=s[1];break}if(6===s[0]&&r.label<a[1]){r.label=a[1],a=s;break}if(a&&r.label<a[2]){r.label=a[2],r.ops.push(s);break}a[2]&&r.ops.pop(),r.trys.pop();continue}s=n.call(t,r)}catch(t){s=[6,t],o=0}finally{e=a=0}if(5&s[0])throw s[1];return{value:s[0]?s[1]:void 0,done:!0}}([s,u])}}}function i(t,n,e){if(e||2===arguments.length)for(var o,a=0,i=n.length;a<i;a++)!o&&a in n||(o||(o=Array.prototype.slice.call(n,0,a)),o[a]=n[a]);return t.concat(o||Array.prototype.slice.call(n))}var r=new Uint8Array(16);function s(){if(!n&&!(n="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto)))throw new Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");return n(r)}var u=/^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-5][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000)$/i;for(var d=[],c=0;c<256;++c)d.push((c+256).toString(16).substr(1));function l(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,e=(d[t[n+0]]+d[t[n+1]]+d[t[n+2]]+d[t[n+3]]+"-"+d[t[n+4]]+d[t[n+5]]+"-"+d[t[n+6]]+d[t[n+7]]+"-"+d[t[n+8]]+d[t[n+9]]+"-"+d[t[n+10]]+d[t[n+11]]+d[t[n+12]]+d[t[n+13]]+d[t[n+14]]+d[t[n+15]]).toLowerCase();if(!function(t){return"string"==typeof t&&u.test(t)}(e))throw TypeError("Stringified UUID is invalid");return e}function f(t,n,e){var o=(t=t||{}).random||(t.rng||s)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,n){e=e||0;for(var a=0;a<16;++a)n[e+a]=o[a];return n}return l(o)}var p,v,y,w,m=function(){var t={},n=function(n,e){return(t[n]=t[n]||[]).push(e),function(){t[n]=t[n].filter((function(t){return t!==e}))}};return{events:t,emit:function(n){for(var e=[],o=1;o<arguments.length;o++)e[o-1]=arguments[o];for(var a=0,i=t[n]||[];a<i.length;a++){i[a].apply(void 0,e)}},on:n,once:function(t,e){var o=n(t,(function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];e.apply(void 0,t),o()}));return o},clear:function(){t={}}}},_=function(t,n){if("object"!=typeof t||null===t)return t===n;if(Array.isArray(t))return!(!Array.isArray(n)||t.length!==n.length)&&!t.some((function(t,e){return!_(t,n[e])}));if("object"!=typeof n||null===n)return!1;var e=Object.entries(t),o=Object.entries(n);return e.length===o.length&&!e.some((function(t){var e=t[0],o=t[1];return!(e in n&&_(o,n[e]))}))},h=function(t,n){return"character"===n.type?t.findIndex((function(t){return"character"===t.type&&t.character.id===n.character.id})):["insets","minimum_static_insets","maximum_static_insets","dynamic_insets"].includes(n.type)?t.findIndex((function(t){return t.type===n.type})):"app_context"===n.type?t.findIndex((function(t){return"app_context"===t.type})):t.findIndex((function(t){return _(t,n)}))},g=(p=!1,v=[],y=[],w=[],{pull:function(){return p=!0,v=i([],window.appInitialData||[]),i([],v)},get:function(){return i([],window.appInitialData||[])},commit:function(){y=i([],window.appInitialData||[]),w=!0===p?(window.appInitialData||[]).filter((function(t){return!(h(v,t)>=0)})):i([],window.appInitialData||[])},diff:function(){return i([],w)},isCommitted:function(t){var n=h(y,t),e=n>=0;return e&&y.splice(n,1),e},find:function(t){var n=t.type,e=t.command,o=i([],window.appInitialData||[]).find((function(t){return!(e||!n||n!==t.type)||(e&&"smart_app_data"in t?e===t.smart_app_data.command||e===t.smart_app_data.type:void 0)}));return o&&"smart_app_data"in o?o.smart_app_data:o}}),b=["A","AUDIO","BUTTON","INPUT","OPTION","SELECT","TEXTAREA","VIDEO"];if(/[a-zA-Z]/.test("1.21.5")&&console.info("%cPlease use the latest version of SaluteJS Client. Your version is 1.21.5","color: yellow; font-size: 14px"),"undefined"!=typeof window&&function(){try{return window.self!==window.parent}catch(t){return!0}}()){var S=function(t){var n;null===(n=window.parent)||void 0===n||n.postMessage(JSON.stringify(t),"*")},A=function(){var t=window.location.href;window.history.back(),setTimeout((function(){window.location.href===t&&S({type:"close"})}),500)};window.appInitialData=[],window.AssistantHost={sendDataContainer:function(t){S({type:"sendDataContainer",payload:t})},close:function(){S({type:"close"})},sendData:function(t){S({type:"sendData",payload:t})},setSuggests:function(t){S({type:"setSuggests",payload:t})},setHints:function(t){S({type:"setHints",payload:t})},ready:function(){S({type:"ready"})},sendText:function(t){S({type:"sendText",payload:t})},setHeaderButtons:function(t){S({type:"setHeaderButtons",payload:t})}},window.addEventListener("message",(function(t){var n,e,o,a,i,r,s,u;try{if("string"==typeof t.data){var d=JSON.parse(t.data);switch(d.type){case"onBack":A();break;case"onData":null===(e=null===(n=window.AssistantClient)||void 0===n?void 0:n.onData)||void 0===e||e.call(n,d.payload);break;case"onRequestState":var c=null===(a=null===(o=window.AssistantClient)||void 0===o?void 0:o.onRequestState)||void 0===a?void 0:a.call(o);S({type:"state",payload:c,requestId:d.requestId});break;case"onRequestRecoveryState":var l=null===(r=null===(i=window.AssistantClient)||void 0===i?void 0:i.onRequestRecoveryState)||void 0===r?void 0:r.call(i);S({type:"recoveryState",payload:l});break;case"onStart":null===(u=null===(s=window.AssistantClient)||void 0===s?void 0:s.onStart)||void 0===u||u.call(s);break;default:console.error(t,"Unknown parsed message")}}}catch(t){console.error(t,"Unknown message")}})),window.addEventListener("keydown",(function(t){var n,e;switch(t.code){case"Enter":document.activeElement&&!b.includes(document.activeElement.tagName)&&(null===(e=(n=document.activeElement).click)||void 0===e||e.call(n));break;case"Escape":A()}}))}"undefined"!=typeof window&&(window.__ASSISTANT_CLIENT__={version:"1.21.5"}),t.createAssistant=function(t){var n,i=t.getState,r=t.getRecoveryState,s=t.ready,u=void 0===s||s,d=m(),c=d.on,l=d.emit,p=m(),v=p.on,y=p.emit,w=new Map,_=i,h=r,b=!1,S=0,A=function(t){return"smart_app_data"===t.type&&l("command",t.smart_app_data),"smart_app_error"===t.type&&l("error",t.smart_app_error),l("data",t)},I=void 0!==(null===(n=window.AssistantHost)||void 0===n?void 0:n.cancelTts)?function(){var t,n;null===(n=(t=window.AssistantHost).cancelTts)||void 0===n||n.call(t,"")}:void 0,T=function(t){void 0===window.__ASSISTANT_CLIENT__.firstSmartAppDataMid&&(window.__ASSISTANT_CLIENT__.firstSmartAppDataMid=t)};window.AssistantClient={onData:function(t){var n,o,a,i,r;if(!g.isCommitted(t)&&(y(t.type,t),"smart_app_data"===t.type&&"-1"!==((null===(n=t.sdk_meta)||void 0===n?void 0:n.mid)||"-1")&&T(null===(o=t.sdk_meta)||void 0===o?void 0:o.mid),"system"!==t.type||"BACK"!==(null===(i=null===(a=t.system)||void 0===a?void 0:a.command)||void 0===i?void 0:i.toUpperCase()))){if("tts_state_update"===t.type&&l("tts",{state:t.state,owner:t.owner}),("smart_app_data"===t.type||"smart_app_error"===t.type)&&(null===(r=t.sdk_meta)||void 0===r?void 0:r.requestId)&&w.has(t.sdk_meta.requestId)){var s=t.sdk_meta;s.requestId;var u=function(t,n){var e={};for(var o in t)Object.prototype.hasOwnProperty.call(t,o)&&n.indexOf(o)<0&&(e[o]=t[o]);if(null!=t&&"function"==typeof Object.getOwnPropertySymbols){var a=0;for(o=Object.getOwnPropertySymbols(t);a<o.length;a++)n.indexOf(o[a])<0&&Object.prototype.propertyIsEnumerable.call(t,o[a])&&(e[o[a]]=t[o[a]])}return e}(s,["requestId"]),d=w.get(t.sdk_meta.requestId)||{},c=d.requestId,f=d.next;(Object.keys(u).length>0||c)&&(t.sdk_meta=e({},u),c&&(t.sdk_meta={requestId:c})),null==f||f((t.type,t))}A(t)}},onRequestState:function(){return _()},onRequestRecoveryState:function(){if(h)return h()},onStart:function(){l("start"),b||(g.diff().forEach((function(t){return A(t)})),b=!0)}};var x=function(){return o(void 0,void 0,void 0,(function(){var t,n,e,o;return a(this,(function(a){return S+=1,"function"!=typeof(null===(n=window.AssistantHost)||void 0===n?void 0:n.ready)?[2,new Promise((function(t,n){var e;if(S>3)throw new Error('window.AssistantHost is not ready. The ready method has the type "'+typeof(null===(e=window.AssistantHost)||void 0===e?void 0:e.ready)+'"');window.setTimeout((function(){x().then(t,n)}),500)}))]:(t=(null===(o=null===(e=g.get().find((function(t){var n;return"smart_app_data"===t.type&&"-1"!==((null===(n=t.sdk_meta)||void 0===n?void 0:n.mid)||"-1")})))||void 0===e?void 0:e.sdk_meta)||void 0===o?void 0:o.mid)||"-1","-1"!==t&&T(t),g.commit(),window.AssistantHost.ready(),[2])}))}))};u&&window.setTimeout(x);var O=function(t,n){var e,o,a,i=t.action,r=t.name,s=t.requestId;if(null===(e=window.AssistantHost)||void 0===e?void 0:e.sendDataContainer){if(null==n)return null===(o=window.AssistantHost)||void 0===o||o.sendDataContainer(JSON.stringify({data:i,message_name:r||"",requestId:s})),function(){};if(s&&w.has(s))throw new Error("requestId должен быть уникальным");var u=s||f(),d=function(t){var n=m(),e=n.on,o=n.emit;return t({next:function(t){o("next",t)}}),{subscribe:function(t){var n=t.next;return{unsubscribe:e("next",n)}}}}((function(t){var n,e=t.next;null===(n=window.AssistantHost)||void 0===n||n.sendDataContainer(JSON.stringify({data:i,message_name:r||"",requestId:u})),w.set(u,{next:e,requestId:s})})).subscribe,c=d({next:n}).unsubscribe;return function(){c(),w.delete(u)}}if(null!=n)throw new Error("Не поддерживается в данной версии клиента");return null===(a=window.AssistantHost)||void 0===a||a.sendData(JSON.stringify(i),r||null),function(){}};return{cancelTts:I,close:function(){var t;return null===(t=window.AssistantHost)||void 0===t?void 0:t.close()},getInitialData:g.pull,findInInitialData:g.find,getRecoveryState:function(){return window.appRecoveryState},on:c,subscribeToCommand:v,sendAction:function(t,n,e,o){var a=void 0===o?{}:o,i=a.name,r=a.requestId;return O({action:t,name:i,requestId:r},(function(t){"smart_app_data"===t.type&&(null==n||n(t.smart_app_data)),"smart_app_error"===t.type&&(null==e||e(t.smart_app_error))}))},sendData:O,setGetState:function(t){_=t},setGetRecoveryState:function(t){h=t},setSuggests:function(t){var n;null===(n=window.AssistantHost)||void 0===n||n.setSuggests(JSON.stringify({suggestions:{buttons:t}}))},setHints:function(t){var n;null===(n=window.AssistantHost)||void 0===n||n.setHints(JSON.stringify({hints:t}))},sendText:function(t){var n;return null===(n=window.AssistantHost)||void 0===n?void 0:n.sendText(t)},setHeaderButtons:function(t){var n,e;if(!(null===(n=window.AssistantHost)||void 0===n?void 0:n.setHeaderButtons))throw new Error("setHeaderButtons не поддерживается в данной версии клиента");null===(e=window.AssistantHost)||void 0===e||e.setHeaderButtons(JSON.stringify(t))},ready:x}}}));
